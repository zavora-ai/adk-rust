{
  "id": "tpl-api-health-dashboard",
  "version": "1.0.0",
  "name": "API Health Dashboard",
  "description": "Monitor multiple API endpoints in parallel, aggregate health status, diagnose failures with AI, and alert on degradation or outages",
  "settings": {
    "default_model": "gemini-2.0-flash",
    "env_vars": {},
    "layoutDirection": "LR",
    "layoutMode": "free",
    "debugMode": false
  },
  "agents": {
    "health_analyst": {
      "type": "llm",
      "model": "gemini-2.0-flash",
      "instruction": "You are an API reliability engineer. Given health check results from multiple endpoints, analyze the overall system health and identify issues.\n\nAnalyze:\n- Which endpoints are healthy, degraded, or down\n- Response time trends (flag if >2x normal)\n- Error rate patterns\n- Correlation between failures (shared dependency?)\n- Impact assessment on end users\n\nOutput JSON:\n{\"overall_status\": \"healthy|degraded|partial_outage|major_outage\", \"healthy_count\": 4, \"degraded_count\": 1, \"down_count\": 1, \"issues\": [{\"endpoint\": \"/api/users\", \"status\": \"down\", \"error\": \"Connection refused\", \"likely_cause\": \"Database connection pool exhausted\", \"impact\": \"User login and profile features unavailable\", \"suggested_action\": \"Restart connection pool or scale database\"}], \"correlated_failures\": \"Users and Orders endpoints share the same DB ‚Äî likely a database issue\", \"user_impact_summary\": \"~30% of features affected\", \"recommended_status_page\": \"Investigating elevated error rates on user-facing APIs\"}",
      "tools": [],
      "sub_agents": [],
      "position": { "x": 0, "y": 0 }
    }
  },
  "tools": {},
  "tool_configs": {},
  "actionNodes": {
    "manual_trigger": {
      "type": "trigger",
      "id": "manual_trigger",
      "name": "Health Check",
      "description": "Run a full health check across all monitored endpoints",
      "triggerType": "manual",
      "manual": {
        "buttonLabel": "Run Health Check",
        "defaultPrompt": "Run full API health check for production environment. Check all critical endpoints and report status.",
        "showPromptInput": true
      },
      "errorHandling": { "mode": "stop" },
      "tracing": { "enabled": true, "logLevel": "info" },
      "callbacks": {},
      "execution": { "timeout": 30000 },
      "mapping": { "outputKey": "trigger_input" }
    },
    "check_auth": {
      "type": "http",
      "id": "check_auth",
      "name": "Check Auth API",
      "description": "Health check the authentication service",
      "method": "GET",
      "url": "https://{{API_BASE_URL}}/health/auth",
      "auth": { "type": "bearer", "bearer": { "token": "{{HEALTH_CHECK_TOKEN}}" } },
      "headers": { "Accept": "application/json" },
      "body": { "type": "none" },
      "response": { "type": "json" },
      "errorHandling": { "mode": "continue" },
      "tracing": { "enabled": true, "logLevel": "info" },
      "callbacks": {},
      "execution": { "timeout": 10000 },
      "mapping": { "outputKey": "auth_health" }
    },
    "check_users": {
      "type": "http",
      "id": "check_users",
      "name": "Check Users API",
      "description": "Health check the users service",
      "method": "GET",
      "url": "https://{{API_BASE_URL}}/health/users",
      "auth": { "type": "bearer", "bearer": { "token": "{{HEALTH_CHECK_TOKEN}}" } },
      "headers": { "Accept": "application/json" },
      "body": { "type": "none" },
      "response": { "type": "json" },
      "errorHandling": { "mode": "continue" },
      "tracing": { "enabled": true, "logLevel": "info" },
      "callbacks": {},
      "execution": { "timeout": 10000 },
      "mapping": { "outputKey": "users_health" }
    },
    "check_payments": {
      "type": "http",
      "id": "check_payments",
      "name": "Check Payments API",
      "description": "Health check the payments service",
      "method": "GET",
      "url": "https://{{API_BASE_URL}}/health/payments",
      "auth": { "type": "bearer", "bearer": { "token": "{{HEALTH_CHECK_TOKEN}}" } },
      "headers": { "Accept": "application/json" },
      "body": { "type": "none" },
      "response": { "type": "json" },
      "errorHandling": { "mode": "continue" },
      "tracing": { "enabled": true, "logLevel": "info" },
      "callbacks": {},
      "execution": { "timeout": 10000 },
      "mapping": { "outputKey": "payments_health" }
    },
    "check_orders": {
      "type": "http",
      "id": "check_orders",
      "name": "Check Orders API",
      "description": "Health check the orders service",
      "method": "GET",
      "url": "https://{{API_BASE_URL}}/health/orders",
      "auth": { "type": "bearer", "bearer": { "token": "{{HEALTH_CHECK_TOKEN}}" } },
      "headers": { "Accept": "application/json" },
      "body": { "type": "none" },
      "response": { "type": "json" },
      "errorHandling": { "mode": "continue" },
      "tracing": { "enabled": true, "logLevel": "info" },
      "callbacks": {},
      "execution": { "timeout": 10000 },
      "mapping": { "outputKey": "orders_health" }
    },
    "check_search": {
      "type": "http",
      "id": "check_search",
      "name": "Check Search API",
      "description": "Health check the search/elasticsearch service",
      "method": "GET",
      "url": "https://{{API_BASE_URL}}/health/search",
      "auth": { "type": "bearer", "bearer": { "token": "{{HEALTH_CHECK_TOKEN}}" } },
      "headers": { "Accept": "application/json" },
      "body": { "type": "none" },
      "response": { "type": "json" },
      "errorHandling": { "mode": "continue" },
      "tracing": { "enabled": true, "logLevel": "info" },
      "callbacks": {},
      "execution": { "timeout": 10000 },
      "mapping": { "outputKey": "search_health" }
    },
    "aggregate_results": {
      "type": "transform",
      "id": "aggregate_results",
      "name": "Aggregate Results",
      "description": "Combine all health check results into a single report",
      "transformExpression": "{ endpoints: { auth: input.auth_health, users: input.users_health, payments: input.payments_health, orders: input.orders_health, search: input.search_health }, checked_at: new Date().toISOString(), total_endpoints: 5 }",
      "inputKey": "all_health",
      "errorHandling": { "mode": "continue" },
      "tracing": { "enabled": true, "logLevel": "info" },
      "callbacks": {},
      "execution": { "timeout": 5000 },
      "mapping": { "outputKey": "aggregated_health" }
    },
    "route_status": {
      "type": "switch",
      "id": "route_status",
      "name": "Route by Status",
      "description": "Route based on overall health: outage gets paged, degraded gets alerted, healthy gets logged",
      "evaluationMode": "first_match",
      "conditions": [
        { "id": "outage", "name": "Outage", "field": "health_analysis.overall_status", "operator": "in", "value": "major_outage,partial_outage", "outputPort": "outage" },
        { "id": "degraded", "name": "Degraded", "field": "health_analysis.overall_status", "operator": "eq", "value": "degraded", "outputPort": "degraded" }
      ],
      "defaultBranch": "healthy",
      "errorHandling": { "mode": "stop" },
      "tracing": { "enabled": true, "logLevel": "info" },
      "callbacks": {},
      "execution": { "timeout": 5000 },
      "mapping": { "outputKey": "status_route" }
    },
    "set_outage": {
      "type": "set",
      "id": "set_outage",
      "name": "Outage Response",
      "description": "Set outage alert parameters ‚Äî page on-call, update status page",
      "mode": "set",
      "variables": [
        { "key": "alert_level", "value": "critical", "valueType": "string", "isSecret": false },
        { "key": "notify_channel", "value": "#incidents", "valueType": "string", "isSecret": false },
        { "key": "page_oncall", "value": "true", "valueType": "boolean", "isSecret": false },
        { "key": "update_status_page", "value": "true", "valueType": "boolean", "isSecret": false }
      ],
      "errorHandling": { "mode": "stop" },
      "tracing": { "enabled": true, "logLevel": "info" },
      "callbacks": {},
      "execution": { "timeout": 5000 },
      "mapping": { "outputKey": "alert_config" }
    },
    "set_degraded": {
      "type": "set",
      "id": "set_degraded",
      "name": "Degraded Alert",
      "description": "Set degraded alert parameters ‚Äî notify engineering",
      "mode": "set",
      "variables": [
        { "key": "alert_level", "value": "warning", "valueType": "string", "isSecret": false },
        { "key": "notify_channel", "value": "#engineering-alerts", "valueType": "string", "isSecret": false },
        { "key": "page_oncall", "value": "false", "valueType": "boolean", "isSecret": false },
        { "key": "update_status_page", "value": "false", "valueType": "boolean", "isSecret": false }
      ],
      "errorHandling": { "mode": "stop" },
      "tracing": { "enabled": true, "logLevel": "info" },
      "callbacks": {},
      "execution": { "timeout": 5000 },
      "mapping": { "outputKey": "alert_config" }
    },
    "set_healthy": {
      "type": "set",
      "id": "set_healthy",
      "name": "All Healthy",
      "description": "All systems operational ‚Äî log only",
      "mode": "set",
      "variables": [
        { "key": "alert_level", "value": "info", "valueType": "string", "isSecret": false },
        { "key": "notify_channel", "value": "#ops-log", "valueType": "string", "isSecret": false },
        { "key": "page_oncall", "value": "false", "valueType": "boolean", "isSecret": false }
      ],
      "errorHandling": { "mode": "stop" },
      "tracing": { "enabled": true, "logLevel": "info" },
      "callbacks": {},
      "execution": { "timeout": 5000 },
      "mapping": { "outputKey": "alert_config" }
    },
    "merge_alerts": {
      "type": "merge",
      "id": "merge_alerts",
      "name": "Merge",
      "description": "Rejoin alert branches",
      "mode": "wait_all",
      "combineStrategy": "object",
      "timeout": { "enabled": true, "ms": 10000, "behavior": "continue" },
      "errorHandling": { "mode": "continue" },
      "tracing": { "enabled": true, "logLevel": "info" },
      "callbacks": {},
      "execution": { "timeout": 15000 },
      "mapping": { "outputKey": "merged_alert" }
    },
    "post_alert": {
      "type": "http",
      "id": "post_alert",
      "name": "Post Alert",
      "description": "Send health status to the appropriate Slack channel",
      "method": "POST",
      "url": "https://slack.com/api/chat.postMessage",
      "auth": { "type": "bearer", "bearer": { "token": "{{SLACK_BOT_TOKEN}}" } },
      "headers": { "Content-Type": "application/json" },
      "body": {
        "type": "json",
        "content": "{\"channel\": \"{{alert_config.notify_channel}}\", \"text\": \"üè• *API Health Report* [{{alert_config.alert_level}}]\\nStatus: {{health_analysis.overall_status}}\\n‚úÖ Healthy: {{health_analysis.healthy_count}} | ‚ö†Ô∏è Degraded: {{health_analysis.degraded_count}} | ‚ùå Down: {{health_analysis.down_count}}\\n\\n{{health_analysis.user_impact_summary}}\"}"
      },
      "response": { "type": "json" },
      "errorHandling": { "mode": "retry", "retryCount": 2, "retryDelay": 1000 },
      "tracing": { "enabled": true, "logLevel": "info" },
      "callbacks": {},
      "execution": { "timeout": 10000 },
      "mapping": { "outputKey": "slack_result" }
    },
    "log_check": {
      "type": "database",
      "id": "log_check",
      "name": "Log Health Check",
      "description": "Record health check results for historical tracking",
      "dbType": "postgresql",
      "connection": { "connectionString": "{{DATABASE_URL}}", "poolSize": 3 },
      "sql": {
        "operation": "insert",
        "query": "INSERT INTO health_checks (overall_status, healthy_count, degraded_count, down_count, alert_level, checked_at) VALUES ($1, $2, $3, $4, $5, NOW())",
        "parameters": ["{{health_analysis.overall_status}}", "{{health_analysis.healthy_count}}", "{{health_analysis.degraded_count}}", "{{health_analysis.down_count}}", "{{alert_config.alert_level}}"]
      },
      "errorHandling": { "mode": "continue" },
      "tracing": { "enabled": true, "logLevel": "info" },
      "callbacks": {},
      "execution": { "timeout": 10000 },
      "mapping": { "outputKey": "db_result" }
    }
  },
  "workflow": {
    "type": "graph",
    "edges": [
      { "from": "manual_trigger", "to": "START" },
      { "from": "START", "to": "check_auth" },
      { "from": "START", "to": "check_users" },
      { "from": "START", "to": "check_payments" },
      { "from": "START", "to": "check_orders" },
      { "from": "START", "to": "check_search" },
      { "from": "check_auth", "to": "aggregate_results" },
      { "from": "check_users", "to": "aggregate_results" },
      { "from": "check_payments", "to": "aggregate_results" },
      { "from": "check_orders", "to": "aggregate_results" },
      { "from": "check_search", "to": "aggregate_results" },
      { "from": "aggregate_results", "to": "health_analyst" },
      { "from": "health_analyst", "to": "route_status" },
      { "from": "route_status", "to": "set_outage", "fromPort": "outage" },
      { "from": "route_status", "to": "set_degraded", "fromPort": "degraded" },
      { "from": "route_status", "to": "set_healthy", "fromPort": "healthy" },
      { "from": "set_outage", "to": "merge_alerts" },
      { "from": "set_degraded", "to": "merge_alerts" },
      { "from": "set_healthy", "to": "merge_alerts" },
      { "from": "merge_alerts", "to": "post_alert" },
      { "from": "post_alert", "to": "log_check" },
      { "from": "log_check", "to": "END" }
    ],
    "conditions": []
  },
  "created_at": "2026-02-08T00:00:00Z",
  "updated_at": "2026-02-08T00:00:00Z"
}